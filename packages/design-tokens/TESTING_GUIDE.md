# 测试验证指南

本文档说明如何验证设计令牌迁移后的功能是否正常。

## 测试前准备

### 1. 确保构建成功

```bash
# 构建设计令牌包
cd packages/design-tokens
pnpm build

# 构建 shared-components
cd ../shared-components
pnpm build
```

### 2. 启动应用

启动一个应用进行测试（建议使用 admin-app）：

```bash
cd ../../apps/admin-app
pnpm dev
```

## 测试项目

### 测试1：浏览器中的变量加载验证

**目标**：验证设计令牌变量在浏览器中正确加载

**步骤**：
1. 打开浏览器开发者工具（F12）
2. 切换到 "Elements" 标签
3. 选择 `<html>` 或 `<body>` 元素
4. 在右侧 "Styles" 面板中，查看 `:root` 的计算样式

**验证标准**：
- [ ] 可以在 `:root` 中找到 `--btc-crud-gap` 变量
- [ ] 变量值正确：`--btc-crud-gap: 10px`
- [ ] 所有8个BTC变量都已加载：
  - `--btc-crud-gap`
  - `--btc-crud-op-width`
  - `--btc-crud-search-width`
  - `--btc-crud-btn-color`
  - `--btc-crud-icon-color`
  - `--btc-icon-color`
  - `--btc-breath-color`
  - `--btc-table-button-color`

**截图位置**：记录浏览器开发者工具中的变量显示

---

### 测试2：CRUD组件功能测试

**目标**：验证CRUD组件样式和功能正常

**测试页面**：任意使用 `BtcCrud` 组件的页面（如模块列表）

**验证项目**：
- [ ] 表格显示正常
- [ ] 搜索框宽度正确（220px）
- [ ] 操作列宽度正确（220px）
- [ ] 行间距正确（10px）
- [ ] 工具栏按钮样式正常
- [ ] 分页器位置正确

**测试步骤**：
1. 打开使用CRUD组件的页面
2. 检查表格布局
3. 检查搜索框和操作列
4. 检查按钮样式
5. 检查分页器

---

### 测试3：通用组件功能测试

**目标**：验证通用组件（图标按钮等）样式正常

**测试组件**：
- `BtcIconButton`
- `BtcSvg`
- 其他使用 `--btc-icon-color` 的组件

**验证项目**：
- [ ] 图标按钮样式正常
- [ ] 图标颜色正确
- [ ] 呼吸灯动画正常（如果有）
- [ ] 悬停效果正常

---

### 测试4：主题切换测试

**目标**：验证亮色/暗色主题切换正常

**测试步骤**：
1. 切换到亮色主题
2. 检查所有组件样式
3. 切换到暗色主题
4. 检查所有组件样式
5. 多次切换，验证稳定性

**验证项目**：
- [ ] 主题切换功能正常
- [ ] 变量值正确更新
- [ ] 所有组件样式正常
- [ ] 无样式破坏
- [ ] 切换过程流畅

**特别注意**：
- 检查 `--btc-*` 变量引用的 Element Plus 变量是否正确更新
- 例如：`--btc-icon-color: var(--el-text-color-primary)` 在暗色主题下应该变为 `#e5eaf3`

---

### 测试5：跨应用测试

**目标**：验证所有14个应用的样式加载正常

**测试应用列表**：
- admin-app
- dashboard-app
- docs-app
- engineering-app
- finance-app
- home-app
- layout-app
- logistics-app
- main-app
- mobile-app
- operations-app
- personnel-app
- production-app
- quality-app
- system-app

**验证项目**：
- [ ] 每个应用都能正常启动
- [ ] 样式加载正常
- [ ] 无样式冲突
- [ ] 功能正常

**测试方法**：
- 逐个应用启动测试
- 或使用自动化测试工具

---

### 测试6：性能测试

**目标**：验证构建和运行时性能

#### 构建性能测试

**测试步骤**：
1. 记录迁移前的构建时间
2. 记录迁移后的构建时间
3. 计算时间差

**验证标准**：
- [ ] 构建时间增加不超过20%

**测试命令**：
```bash
# 测试设计令牌包构建时间
cd packages/design-tokens
time pnpm build

# 测试 shared-components 构建时间
cd ../shared-components
time pnpm build
```

#### 运行时性能测试

**测试项目**：
- [ ] CSS文件大小无明显增加
- [ ] 页面加载时间无明显影响
- [ ] 样式计算性能正常

**测试方法**：
- 使用浏览器性能工具
- 检查网络请求大小
- 检查样式计算时间

---

## 测试检查清单

### 功能测试

- [ ] CRUD组件功能正常
- [ ] 通用组件功能正常
- [ ] 所有按钮样式正常
- [ ] 表格样式正常
- [ ] 搜索框样式正常
- [ ] 分页器样式正常

### 主题测试

- [ ] 亮色主题正常
- [ ] 暗色主题正常
- [ ] 主题切换正常
- [ ] 变量值正确更新

### 跨应用测试

- [ ] admin-app 正常
- [ ] system-app 正常
- [ ] 其他应用正常（至少测试3-5个）

### 性能测试

- [ ] 构建时间增加 < 20%
- [ ] CSS文件大小合理
- [ ] 运行时性能无影响

### 浏览器兼容性

- [ ] Chrome/Edge 正常
- [ ] Firefox 正常
- [ ] Safari 正常（如需要）

---

## 测试报告模板

### 测试环境

- **测试日期**：2026-01-13
- **测试人员**：-
- **测试应用**：admin-app
- **浏览器**：Chrome/Edge
- **主题**：亮色/暗色

### 测试结果

#### 功能测试

| 测试项 | 结果 | 备注 |
|--------|------|------|
| CRUD组件 | ⏳ 待测试 | - |
| 通用组件 | ⏳ 待测试 | - |
| 主题切换 | ⏳ 待测试 | - |

#### 性能测试

| 测试项 | 迁移前 | 迁移后 | 变化 | 备注 |
|--------|--------|--------|------|------|
| 设计令牌包构建 | - | < 1s | - | - |
| shared-components 构建 | - | - | - | 待测试 |

### 问题记录

| 问题 | 严重程度 | 状态 | 备注 |
|------|---------|------|------|
| - | - | - | - |

---

## 问题处理

### 如果测试失败

1. **记录问题**：详细记录问题现象
2. **分析原因**：检查变量定义、使用方式等
3. **修复问题**：根据问题原因修复
4. **重新测试**：修复后重新测试

### 常见问题

#### 问题1：变量未加载

**症状**：浏览器中找不到 `--btc-*` 变量

**可能原因**：
- 设计令牌包未构建
- `_tokens.scss` 导入失败
- 构建配置问题

**解决方案**：
1. 检查设计令牌包是否构建成功
2. 检查 `_tokens.scss` 导入语句
3. 检查 shared-components 构建日志

#### 问题2：变量值不正确

**症状**：变量值不是预期值

**可能原因**：
- 设计令牌JSON文件中的值错误
- 引用关系错误

**解决方案**：
1. 检查设计令牌JSON文件
2. 检查变量引用关系
3. 重新构建设计令牌包

#### 问题3：样式异常

**症状**：组件样式显示异常

**可能原因**：
- 变量名不一致
- 变量未定义
- 样式优先级问题

**解决方案**：
1. 检查变量名是否正确
2. 检查浏览器开发者工具中的变量值
3. 对比迁移前后的样式

---

## 测试完成标准

所有测试项目都通过后，可以标记迁移完成：

- [ ] 功能测试全部通过
- [ ] 主题切换测试通过
- [ ] 跨应用测试通过（至少3-5个应用）
- [ ] 性能测试通过
- [ ] 无阻塞问题

---

## 测试记录

建议在测试过程中记录：

1. **测试日期和时间**
2. **测试环境**（浏览器、应用等）
3. **测试结果**（通过/失败）
4. **问题记录**（如有）
5. **截图**（重要问题的截图）

---

## 参考

- [MIGRATION_ATOMIC_STEPS.md](./MIGRATION_ATOMIC_STEPS.md) - 步骤7.1-7.5
- [MIGRATION_MILESTONES.md](./MIGRATION_MILESTONES.md) - 里程碑M7
