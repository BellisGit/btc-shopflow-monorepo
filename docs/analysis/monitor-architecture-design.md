# ç›‘æ§ç³»ç»Ÿæ¶æ„è®¾è®¡

## ğŸ¯ è®¾è®¡åŸåˆ™

### æ ¸å¿ƒçº¦æŸ
1. **ç‹¬ç«‹æ€§**ï¼šç›‘æ§æœåŠ¡å¿…é¡»èƒ½å¤Ÿç›‘æ§**åŒ…æ‹¬ä¸»åº”ç”¨åœ¨å†…çš„æ‰€æœ‰å¼€å‘æœåŠ¡å™¨**
2. **æ— å¾ªç¯ä¾èµ–**ï¼šç›‘æ§æœåŠ¡ä¸èƒ½ä¾èµ–äºè¢«ç›‘æ§çš„åº”ç”¨
3. **å¯ç”¨æ€§**ï¼šå³ä½¿è¢«ç›‘æ§çš„åº”ç”¨å‡ºç°é—®é¢˜ï¼Œç›‘æ§æœåŠ¡ä¹Ÿåº”ä¿æŒå¯ç”¨

### æ¶æ„åŸåˆ™
- **å‰åç«¯åˆ†ç¦»**ï¼šåç«¯æœåŠ¡ç‹¬ç«‹ï¼Œå‰ç«¯å¯ä»¥æ˜¯ç‹¬ç«‹çš„Vueé¡¹ç›®
- **å•å‘ä¾èµ–**ï¼šç›‘æ§æœåŠ¡ â†’ è¢«ç›‘æ§åº”ç”¨ï¼ˆç›‘æ§æœåŠ¡ä¸»åŠ¨æ”¶é›†ä¿¡æ¯ï¼‰
- **æ¥å£æŠ½è±¡**ï¼šé€šè¿‡HTTP APIå’ŒSSEè¿›è¡Œé€šä¿¡

## ğŸ—ï¸ æ¶æ„è®¾è®¡

### æ•´ä½“æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ç›‘æ§ç³»ç»Ÿæ¶æ„                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç›‘æ§åç«¯æœåŠ¡ (monitor-service.mjs)                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  ç«¯å£: 3001                                        â”‚  â”‚
â”‚  â”‚  è¿è¡Œä½ç½®: scripts/commands/skills/               â”‚  â”‚
â”‚  â”‚                                                    â”‚  â”‚
â”‚  â”‚  åŠŸèƒ½:                                             â”‚  â”‚
â”‚  â”‚  âœ“ ç›‘æ§æ‰€æœ‰åº”ç”¨çš„å¼€å‘æœåŠ¡å™¨                        â”‚  â”‚
â”‚  â”‚  âœ“ æ”¶é›†é”™è¯¯å’Œæ—¥å¿—                                  â”‚  â”‚
â”‚  â”‚  âœ“ æä¾›APIæ¥å£ (/api/*)                           â”‚  â”‚
â”‚  â”‚  âœ“ æä¾›SSEå®æ—¶æ¨é€ (/events)                      â”‚  â”‚
â”‚  â”‚  âœ“ æœåŠ¡å‰ç«¯é™æ€æ–‡ä»¶                                â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â”‚ HTTP/SSE/API
                  â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç›‘æ§å‰ç«¯åº”ç”¨ (apps/monitor-app)                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  ç‹¬ç«‹Vueé¡¹ç›®                                      â”‚  â”‚
â”‚  â”‚  æ„å»ºäº§ç‰©: dist/                                  â”‚  â”‚
â”‚  â”‚                                                    â”‚  â”‚
â”‚  â”‚  åŠŸèƒ½:                                             â”‚  â”‚
â”‚  â”‚  âœ“ æœåŠ¡ç›‘æ§ç•Œé¢                                    â”‚  â”‚
â”‚  â”‚  âœ“ é”™è¯¯ç›‘æ§ç•Œé¢                                    â”‚  â”‚
â”‚  â”‚  âœ“ å®æ—¶æ•°æ®å±•ç¤º                                    â”‚  â”‚
â”‚  â”‚                                                    â”‚  â”‚
â”‚  â”‚  ä¼˜åŠ¿:                                             â”‚  â”‚
â”‚  â”‚  âœ“ å¯ä»¥å¤ç”¨ @btc/shared-components                â”‚  â”‚
â”‚  â”‚  âœ“ å¯ä»¥å¤ç”¨ @btc/shared-core                      â”‚  â”‚
â”‚  â”‚  âœ“ TypeScriptæ”¯æŒ                                 â”‚  â”‚
â”‚  â”‚  âœ“ å®Œæ•´çš„Vueå¼€å‘ä½“éªŒ                               â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  è¢«ç›‘æ§çš„åº”ç”¨ï¼ˆæ‰€æœ‰monorepoä¸­çš„åº”ç”¨ï¼‰                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚ main-app â”‚  â”‚admin-app â”‚  â”‚ops-app   â”‚  ...        â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜            â”‚
â”‚       â”‚             â”‚             â”‚                    â”‚
â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
â”‚              â”‚                                           â”‚
â”‚              â”‚ ä¸ŠæŠ¥é”™è¯¯/æ—¥å¿—                            â”‚
â”‚              â–¼                                           â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                              â”‚
â”‚    â”‚ @btc/shared-core    â”‚                              â”‚
â”‚    â”‚ error-reporter.ts   â”‚                              â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                              â”‚
â”‚              â”‚                                           â”‚
â”‚              â”‚ HTTP POST /api/errors/report             â”‚
â”‚              â–¼                                           â”‚
â”‚    monitor-service.mjs                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ•°æ®æµå‘

```
1. åº”ç”¨å¯åŠ¨/è¿è¡Œ
   â””â”€> åº”ç”¨è¾“å‡ºæ—¥å¿—/é”™è¯¯
       â””â”€> @btc/shared-core/error-reporter
           â””â”€> POST /api/errors/report
               â””â”€> monitor-service.mjs
                   â””â”€> å¹¿æ’­åˆ°æ‰€æœ‰SSEå®¢æˆ·ç«¯
                       â””â”€> monitor-appå‰ç«¯

2. monitor-service.mjsä¸»åŠ¨ç›‘æ§
   â””â”€> æ£€æµ‹è¿è¡Œçš„devæœåŠ¡å™¨
       â””â”€> GET /api/commands
           â””â”€> monitor-appå‰ç«¯

3. monitor-appå‰ç«¯è¯·æ±‚æ•°æ®
   â””â”€> GET /api/commands
       â””â”€> monitor-service.mjs
           â””â”€> è¿”å›è¿è¡Œä¸­çš„å‘½ä»¤åˆ—è¡¨

4. å®æ—¶æ¨é€ï¼ˆSSEï¼‰
   â””â”€> GET /events
       â””â”€> monitor-service.mjs
           â””â”€> å®æ—¶æ¨é€é”™è¯¯å’ŒçŠ¶æ€æ›´æ–°
               â””â”€> monitor-appå‰ç«¯
```

## ğŸ“¦ ç›®å½•ç»“æ„

### monitor-app ç»“æ„

```
apps/monitor-app/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ views/
â”‚   â”‚   â”œâ”€â”€ DevServiceMonitor.vue      # æœåŠ¡ç›‘æ§è§†å›¾
â”‚   â”‚   â””â”€â”€ ErrorMonitor.vue           # é”™è¯¯ç›‘æ§è§†å›¾
â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”œâ”€â”€ ServiceList.vue            # æœåŠ¡åˆ—è¡¨ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ ErrorTable.vue             # é”™è¯¯è¡¨æ ¼ç»„ä»¶
â”‚   â”‚   â””â”€â”€ ConnectionStatus.vue       # è¿æ¥çŠ¶æ€ç»„ä»¶
â”‚   â”œâ”€â”€ stores/
â”‚   â”‚   â”œâ”€â”€ monitor.ts                 # ç›‘æ§çŠ¶æ€ç®¡ç†
â”‚   â”‚   â””â”€â”€ errors.ts                  # é”™è¯¯çŠ¶æ€ç®¡ç†
â”‚   â”œâ”€â”€ api/
â”‚   â”‚   â””â”€â”€ monitor.ts                 # APIæ¥å£å°è£…
â”‚   â”œâ”€â”€ composables/
â”‚   â”‚   â”œâ”€â”€ useSSE.ts                  # SSEè¿æ¥ç®¡ç†
â”‚   â”‚   â””â”€â”€ useMonitorApi.ts           # APIè°ƒç”¨ç®¡ç†
â”‚   â”œâ”€â”€ router/
â”‚   â”‚   â””â”€â”€ index.ts                   # è·¯ç”±é…ç½®
â”‚   â”œâ”€â”€ App.vue
â”‚   â””â”€â”€ main.ts
â”œâ”€â”€ package.json
â”œâ”€â”€ vite.config.ts
â”œâ”€â”€ tsconfig.json
â””â”€â”€ README.md
```

## ğŸ”Œ APIæ¥å£è®¾è®¡

### åç«¯API (monitor-service.mjs)

```
GET  /                          # è¿”å›å‰ç«¯é¡µé¢ï¼ˆæ„å»ºåçš„é™æ€æ–‡ä»¶ï¼‰
GET  /api/commands              # è·å–æ‰€æœ‰è¿è¡Œä¸­çš„å‘½ä»¤
POST /api/commands              # å¯åŠ¨æ–°å‘½ä»¤
DELETE /api/commands/:id        # åœæ­¢å‘½ä»¤
GET  /api/dev/status            # è·å–æ‰€æœ‰åº”ç”¨çš„devæœåŠ¡å™¨çŠ¶æ€
POST /api/dev/start-all         # å¯åŠ¨æ‰€æœ‰åº”ç”¨çš„devæœåŠ¡å™¨
POST /api/dev/stop-all          # åœæ­¢æ‰€æœ‰åº”ç”¨çš„devæœåŠ¡å™¨
POST /api/dev/start/:appId      # å¯åŠ¨å•ä¸ªåº”ç”¨çš„devæœåŠ¡å™¨
POST /api/dev/stop/:appId       # åœæ­¢å•ä¸ªåº”ç”¨çš„devæœåŠ¡å™¨
GET  /api/stats                 # è·å–ç»Ÿè®¡ä¿¡æ¯
POST /api/errors/report         # æ¥æ”¶é”™è¯¯ä¸ŠæŠ¥ï¼ˆä»åº”ç”¨ä»£ç ä¸­ï¼‰
POST /api/startup/event         # æ¥æ”¶å¯åŠ¨äº‹ä»¶ä¸ŠæŠ¥
GET  /events                    # SSEç«¯ç‚¹ï¼ˆå®æ—¶æ¨é€ï¼‰
GET  /sse/dev-status            # DevæœåŠ¡å™¨çŠ¶æ€SSEç«¯ç‚¹
```

### å‰ç«¯APIå°è£… (apps/monitor-app)

```typescript
// src/api/monitor.ts
export const monitorApi = {
  // å‘½ä»¤ç®¡ç†
  getCommands: () => fetch('/api/commands'),
  startCommand: (command: string, args: string[]) => 
    fetch('/api/commands', { method: 'POST', body: JSON.stringify({ command, args }) }),
  stopCommand: (id: string) => 
    fetch(`/api/commands/${id}`, { method: 'DELETE' }),
  
  // DevæœåŠ¡å™¨ç®¡ç†
  getDevStatus: () => fetch('/api/dev/status'),
  startAllDevServers: (exclude?: string[]) => 
    fetch('/api/dev/start-all', { method: 'POST', body: JSON.stringify({ exclude }) }),
  stopAllDevServers: () => 
    fetch('/api/dev/stop-all', { method: 'POST' }),
  startDevServer: (appId: string) => 
    fetch(`/api/dev/start/${appId}`, { method: 'POST' }),
  stopDevServer: (appId: string) => 
    fetch(`/api/dev/stop/${appId}`, { method: 'POST' }),
  
  // ç»Ÿè®¡
  getStats: () => fetch('/api/stats'),
};
```

## ğŸ”„ éƒ¨ç½²æµç¨‹

### å¼€å‘æ¨¡å¼

```bash
# 1. å¯åŠ¨ç›‘æ§åç«¯æœåŠ¡
pnpm monitor

# 2. åœ¨å¦ä¸€ä¸ªç»ˆç«¯å¯åŠ¨ç›‘æ§å‰ç«¯å¼€å‘æœåŠ¡å™¨
cd apps/monitor-app
pnpm dev

# 3. å‰ç«¯å¼€å‘æœåŠ¡å™¨ä¼šä»£ç†APIè¯·æ±‚åˆ°3001ç«¯å£
```

### ç”Ÿäº§æ¨¡å¼

```bash
# 1. æ„å»ºç›‘æ§å‰ç«¯
cd apps/monitor-app
pnpm build

# 2. æ„å»ºäº§ç‰©åœ¨ apps/monitor-app/dist/

# 3. monitor-service.mjs æœåŠ¡æ„å»ºåçš„é™æ€æ–‡ä»¶
#    é€šè¿‡ serveStaticFile() æ–¹æ³•æœåŠ¡ dist/ ç›®å½•
```

### æ›´æ–° monitor-service.mjs

```javascript
// ä¿®æ”¹ serveHTML æ–¹æ³•ï¼ŒæœåŠ¡æ„å»ºåçš„é™æ€æ–‡ä»¶
serveStaticFiles(req, res, pathname) {
  // å¦‚æœæ˜¯æ ¹è·¯å¾„ï¼Œè¿”å› index.html
  if (pathname === '/' || pathname === '/index.html') {
    const indexPath = join(__dirname, '../../apps/monitor-app/dist/index.html');
    const html = readFileSync(indexPath, 'utf-8');
    res.writeHead(200, { 'Content-Type': 'text/html; charset=utf-8' });
    res.end(html);
    return;
  }
  
  // å…¶ä»–é™æ€èµ„æºï¼ˆJSã€CSSç­‰ï¼‰
  const filePath = join(__dirname, '../../apps/monitor-app/dist', pathname);
  // ... æœåŠ¡é™æ€æ–‡ä»¶
}
```

## âœ… ä¼˜åŠ¿æ€»ç»“

1. **ç‹¬ç«‹æ€§ä¿è¯**ï¼š
   - åç«¯æœåŠ¡å®Œå…¨ç‹¬ç«‹ï¼Œå¯ä»¥ç›‘æ§æ‰€æœ‰åº”ç”¨
   - å‰ç«¯åœ¨monorepoä¸­ä½†ä¿æŒç‹¬ç«‹
   - ä¸ä¼šäº§ç”Ÿå¾ªç¯ä¾èµ–

2. **å¼€å‘ä½“éªŒ**ï¼š
   - å®Œæ•´çš„Vue + TypeScriptå¼€å‘ä½“éªŒ
   - å¯ä»¥å¤ç”¨é¡¹ç›®å…±äº«åŒ…
   - çƒ­é‡è½½ã€ç±»å‹æ£€æŸ¥ã€ä»£ç æç¤º

3. **å¯ç»´æŠ¤æ€§**ï¼š
   - æ¸…æ™°çš„ä»£ç ç»“æ„
   - æ¨¡å—åŒ–å’Œç»„ä»¶åŒ–
   - ä¾¿äºæµ‹è¯•å’Œè°ƒè¯•

4. **æ‰©å±•æ€§**ï¼š
   - æ˜“äºæ·»åŠ æ–°åŠŸèƒ½
   - å¯ä»¥é›†æˆæ›´å¤šç›‘æ§æŒ‡æ ‡
   - æ”¯æŒæ’ä»¶åŒ–æ‰©å±•

## ğŸš€ å®æ–½æ­¥éª¤

1. **åˆ›å»ºmonitor-app**ï¼ˆ1å¤©ï¼‰
   - åˆ›å»ºVueé¡¹ç›®ç»“æ„
   - é…ç½®Viteå’ŒTypeScript
   - é…ç½®è·¯ç”±

2. **è¿ç§»åŠŸèƒ½**ï¼ˆ1-2å¤©ï¼‰
   - è¿ç§»æœåŠ¡ç›‘æ§åŠŸèƒ½
   - è¿ç§»é”™è¯¯ç›‘æ§åŠŸèƒ½
   - é›†æˆSSEè¿æ¥

3. **é›†æˆå…±äº«åŒ…**ï¼ˆ0.5å¤©ï¼‰
   - é›†æˆ@btc/shared-components
   - é›†æˆ@btc/shared-core
   - é…ç½®i18nï¼ˆå¯é€‰ï¼‰

4. **æ›´æ–°åç«¯æœåŠ¡**ï¼ˆ0.5å¤©ï¼‰
   - ä¿®æ”¹monitor-service.mjsæœåŠ¡é™æ€æ–‡ä»¶
   - ä¿æŒAPIå…¼å®¹æ€§

5. **æµ‹è¯•å’Œä¼˜åŒ–**ï¼ˆ0.5-1å¤©ï¼‰
   - åŠŸèƒ½æµ‹è¯•
   - æ€§èƒ½ä¼˜åŒ–
   - æ–‡æ¡£æ›´æ–°

**æ€»è®¡**ï¼š3-5å¤©
