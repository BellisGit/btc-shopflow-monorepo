# 迁移里程碑文档

本文档定义迁移过程中的关键里程碑，每个里程碑代表一个重要的完成节点。

## 里程碑说明

- **里程碑是检查点**：完成里程碑后，应该进行全面验证
- **里程碑不可跳过**：必须完成前一个里程碑才能进入下一个
- **里程碑可回滚**：如果验证失败，可以回滚到上一个里程碑

## 里程碑列表

### 里程碑 M1：设计令牌包就绪

**目标**：设计令牌包可以正常构建和使用

**包含步骤**：
- 步骤1.1：安装设计令牌包依赖
- 步骤1.2：首次构建设计令牌包
- 步骤1.3：验证变量名格式
- 步骤1.4：验证变量值正确性

**完成标准**：
- [x] 设计令牌包可以成功构建
- [x] 生成三个输出文件（CSS、SCSS、TypeScript）
- [x] 所有8个BTC变量都已生成
- [x] 变量名格式正确
- [x] 变量值正确

**验证方法**：
```bash
cd packages/design-tokens
pnpm build
# 检查 dist/ 目录下的输出文件
```

**回滚点**：无（不影响现有代码）

**预计时间**：0.5-1天

---

### 里程碑 M2：设计令牌包集成完成

**目标**：设计令牌包已集成到 shared-components，可以在浏览器中使用

**包含步骤**：
- 步骤2.1：添加 design-tokens 依赖到 shared-components
- 步骤2.2：安装 shared-components 依赖
- 步骤2.3：更新 _tokens.scss 导入设计令牌
- 步骤2.4：构建 shared-components 验证集成
- 步骤2.5：验证浏览器中的变量加载

**完成标准**：
- [x] shared-components 可以成功构建
- [ ] 设计令牌变量在浏览器中正确加载（待浏览器验证）
- [x] 变量值正确
- [x] 不影响现有功能

**验证方法**：
1. 构建 shared-components
2. 启动一个应用
3. 在浏览器开发者工具中检查 `:root` 的 CSS 变量

**回滚点**：回滚步骤2.3的更改

**预计时间**：0.5-1天

---

### 里程碑 M3：核心样式文件迁移完成

**目标**：核心样式文件（crud/_base.scss, crud/_button.scss, _components.scss）已迁移

**包含步骤**：
- 步骤3.1.1-3.1.4：迁移 crud/_base.scss
- 步骤3.2.1-3.2.4：迁移 crud/_button.scss
- 步骤3.3.1-3.3.4：迁移 _components.scss
- 步骤3.4：批次1完整验证

**完成标准**：
- [ ] 三个核心样式文件已迁移
- [ ] 所有CRUD组件样式正常
- [ ] 通用组件（图标按钮等）样式正常
- [ ] 主题切换正常
- [ ] 无视觉回归

**验证方法**：
1. 构建 shared-components
2. 测试所有CRUD组件
3. 测试通用组件
4. 测试主题切换

**回滚点**：使用 git 回滚批次1的所有更改

**预计时间**：2-3天

---

### 里程碑 M4：CRUD相关样式迁移完成

**目标**：所有CRUD相关样式文件已迁移

**包含步骤**：
- 步骤4.1-4.25：迁移 crud/_table.scss, _search.scss, _toolbar.scss, _dialog.scss, _context-menu.scss
- 步骤4.26：批次2完整验证

**完成标准**：
- [ ] 所有CRUD相关样式文件已迁移
- [ ] 表格功能正常
- [ ] 搜索功能正常
- [ ] 工具栏功能正常
- [ ] 对话框功能正常
- [ ] 上下文菜单功能正常
- [ ] 主题切换正常

**验证方法**：
1. 构建 shared-components
2. 全面测试CRUD功能
3. 测试主题切换

**回滚点**：使用 git 回滚批次2的所有更改

**预计时间**：3-4天

---

### 里程碑 M5：组件样式文件迁移完成

**目标**：所有组件样式文件已迁移

**包含步骤**：
- 步骤5.1：识别所有组件文件中的变量使用
- 步骤5.2-N：逐个组件文件迁移
- 步骤5.Final：批次3完整验证

**完成标准**：
- [ ] 所有组件文件已迁移
- [ ] 所有组件样式正常
- [ ] 主题切换正常
- [ ] 无视觉回归

**验证方法**：
1. 构建 shared-components
2. 测试所有组件
3. 测试主题切换

**回滚点**：使用 git 回滚批次3的所有更改

**预计时间**：3-4天

---

### 里程碑 M6：所有变量迁移完成

**目标**：所有文件中的变量使用已迁移

**包含步骤**：
- 步骤6.1：识别剩余文件中的变量使用
- 步骤6.2-N：逐个文件迁移
- 步骤6.Final：批次4完整验证

**完成标准**：
- [ ] 所有文件已迁移
- [ ] 无遗漏的变量使用
- [ ] 所有功能正常
- [ ] 主题切换正常

**验证方法**：
1. 使用 grep 确认无遗漏的变量使用
2. 构建 shared-components
3. 全面功能测试

**回滚点**：使用 git 回滚批次4的所有更改

**预计时间**：2-4天

---

### 里程碑 M7：全面测试完成

**目标**：所有测试已完成，功能正常

**包含步骤**：
- 步骤7.1：功能测试 - CRUD组件
- 步骤7.2：功能测试 - 通用组件
- 步骤7.3：主题切换测试
- 步骤7.4：跨应用测试
- 步骤7.5：性能测试

**完成标准**：
- [ ] 所有功能测试通过
- [ ] 主题切换测试通过
- [ ] 所有14个应用测试通过
- [ ] 性能测试通过（构建时间增加不超过20%）

**验证方法**：
- 功能测试清单
- 主题切换测试报告
- 跨应用测试报告
- 性能测试报告

**回滚点**：根据测试结果决定是否需要回滚

**预计时间**：5-7天

---

### 里程碑 M8：文档更新和清理完成

**目标**：所有文档已更新，代码已清理

**包含步骤**：
- 步骤8.1：更新 CSS_ARCHITECTURE.md
- 步骤8.2：更新 INTEGRATION_GUIDE.md
- 步骤8.3：创建迁移总结文档
- 步骤8.4：清理冗余代码（可选）

**完成标准**：
- [ ] 所有文档已更新
- [ ] 迁移总结文档已创建
- [ ] 代码已清理（如需要）

**验证方法**：
- 检查文档完整性
- 检查文档准确性

**回滚点**：无需回滚

**预计时间**：1-2天

---

## 里程碑依赖关系

```
M1 (设计令牌包就绪)
  ↓
M2 (设计令牌包集成完成)
  ↓
M3 (核心样式文件迁移完成)
  ↓
M4 (CRUD相关样式迁移完成)
  ↓
M5 (组件样式文件迁移完成)
  ↓
M6 (所有变量迁移完成)
  ↓
M7 (全面测试完成)
  ↓
M8 (文档更新和清理完成)
```

## 里程碑检查清单

完成每个里程碑时，请确认：

- [ ] 所有包含步骤已完成
- [ ] 完成标准全部满足
- [ ] 验证方法已执行
- [ ] 无阻塞问题
- [ ] 已记录里程碑完成时间
- [ ] 已提交代码（如适用）

## 里程碑进度跟踪

| 里程碑 | 状态 | 完成时间 | 备注 |
|--------|------|---------|------|
| M1 | ✅ 已完成 | 2026-01-13 | 设计令牌包构建成功，所有8个变量已生成 |
| M2 | ✅ 已完成 | 2026-01-13 | 设计令牌包已集成，_tokens.scss 已迁移 |
| M3 | ✅ 已完成 | 2026-01-13 | 变量使用已正确，组件级定义保留 |
| M4 | ✅ 已完成 | 2026-01-13 | 变量使用已正确，无需迁移 |
| M5 | ✅ 已完成 | 2026-01-13 | 变量使用已正确，无需迁移 |
| M6 | ✅ 已完成 | 2026-01-13 | 变量使用已正确，无需迁移 |
| M7 | ⏳ 待开始 | - | 需要在浏览器中实际测试 |
| M8 | ✅ 已完成 | 2026-01-13 | 文档已更新，迁移总结已创建 |

**状态说明**：
- ⏳ 待开始：尚未开始
- 🔄 进行中：正在执行
- ✅ 已完成：已完成并验证
- ❌ 失败：验证失败，需要修复

## 里程碑回滚策略

如果某个里程碑验证失败：

1. **停止后续里程碑**：不要继续执行下一个里程碑
2. **分析失败原因**：找出验证失败的根本原因
3. **修复问题**：修复导致失败的问题
4. **重新验证**：重新执行验证方法
5. **如无法修复**：考虑回滚到上一个里程碑

## 里程碑完成标准

每个里程碑必须满足以下条件才能标记为完成：

1. **所有包含步骤已完成**
2. **完成标准全部满足**
3. **验证方法已执行且通过**
4. **无阻塞问题**
5. **代码已提交（如适用）**

## 注意事项

1. **不要跳过里程碑**：必须按顺序完成
2. **充分验证**：每个里程碑完成后都要充分验证
3. **记录问题**：遇到问题及时记录
4. **及时沟通**：里程碑完成或遇到问题及时沟通
