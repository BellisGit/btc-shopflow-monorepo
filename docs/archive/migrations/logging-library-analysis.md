# æ—¥å¿—åº“å¼•å…¥å¿…è¦æ€§åˆ†æ

## é¡¹ç›®ç°çŠ¶

### æŠ€æœ¯æ ˆ
- **å‰ç«¯**: Vue 3 + TypeScript + Viteï¼ˆå¾®å‰ç«¯æ¶æ„ï¼‰
- **åç«¯**: Spring Boot 2.7.6 + Spring Cloudï¼ˆJavaï¼Œä½¿ç”¨ Logback/Log4j2ï¼‰

### å½“å‰æ—¥å¿—ä½¿ç”¨æƒ…å†µ

#### å‰ç«¯æ—¥å¿—ç°çŠ¶
1. **å¤§é‡ä½¿ç”¨ console æ–¹æ³•**
   - é¡¹ç›®ä¸­å­˜åœ¨ **5158 å¤„** `console.log/error/warn/info/debug` è°ƒç”¨
   - åˆ†æ•£åœ¨ 735 ä¸ªæ–‡ä»¶ä¸­

2. **å·²æœ‰è‡ªå®šä¹‰æ—¥å¿—ç³»ç»Ÿ**
   - `mobile-app` ä¸­æœ‰åŸºäº IndexedDB çš„æ—¥å¿—ç¼“å†²ç³»ç»Ÿ
   - å¤šä¸ªåº”ç”¨æœ‰ `request-logger.ts` ç”¨äºè¯·æ±‚æ—¥å¿—è®°å½•
   - æ—¥å¿—è¿‡æ»¤ç³»ç»Ÿï¼ˆ`useQiankunLogFilter.ts`ï¼‰

3. **æ—¥å¿—åŠŸèƒ½**
   - æ—¥å¿—çº§åˆ«ï¼šdebug, info, warn, error
   - æ—¥å¿—å­˜å‚¨ï¼šIndexedDBï¼ˆç§»åŠ¨ç«¯ï¼‰
   - æ—¥å¿—ä¸ŠæŠ¥ï¼šè¯·æ±‚æ—¥å¿—æ‰¹é‡ä¸ŠæŠ¥åˆ°åç«¯
   - æ—¥å¿—è¿‡æ»¤ï¼šè¿‡æ»¤æ•æ„Ÿæ¥å£å’Œè¡¨å•éªŒè¯é”™è¯¯

#### åç«¯æ—¥å¿—ç°çŠ¶
- Spring Boot é»˜è®¤ä½¿ç”¨ Logback
- å·²æœ‰å®Œæ•´çš„æ—¥å¿—åŸºç¡€è®¾æ–½ï¼ˆELK Stack æ”¯æŒï¼‰
- **ä¸éœ€è¦** Node.js æ—¥å¿—åº“ï¼ˆwinston/pinoï¼‰

---

## æ˜¯å¦éœ€è¦å¼•å…¥æ—¥å¿—åº“ï¼Ÿ

### å‰ç«¯æ˜¯å¦éœ€è¦ winston/pinoï¼Ÿ

#### âœ… **å»ºè®®å¼•å…¥** - ç†ç”±å¦‚ä¸‹ï¼š

**1. å½“å‰é—®é¢˜**
- âŒ å¤§é‡ `console.*` è°ƒç”¨éš¾ä»¥ç»Ÿä¸€ç®¡ç†
- âŒ ç”Ÿäº§ç¯å¢ƒæ— æ³•æ§åˆ¶æ—¥å¿—è¾“å‡ºçº§åˆ«
- âŒ ç¼ºå°‘ç»“æ„åŒ–æ—¥å¿—æ ¼å¼
- âŒ æ— æ³•æ–¹ä¾¿åœ°é›†æˆæ—¥å¿—ä¸ŠæŠ¥æœåŠ¡
- âŒ å¼€å‘/ç”Ÿäº§ç¯å¢ƒæ—¥å¿—è¡Œä¸ºä¸ä¸€è‡´

**2. å¼•å…¥æ—¥å¿—åº“çš„ä¼˜åŠ¿**
- âœ… **ç»Ÿä¸€æ—¥å¿—æ¥å£**ï¼šæ›¿æ¢æ‰€æœ‰ `console.*` è°ƒç”¨
- âœ… **æ—¥å¿—çº§åˆ«æ§åˆ¶**ï¼šå¼€å‘/ç”Ÿäº§ç¯å¢ƒè‡ªåŠ¨åˆ‡æ¢
- âœ… **ç»“æ„åŒ–æ—¥å¿—**ï¼šJSON æ ¼å¼ï¼Œä¾¿äºåˆ†æå’Œä¸ŠæŠ¥
- âœ… **æ€§èƒ½ä¼˜åŒ–**ï¼šç”Ÿäº§ç¯å¢ƒå¯å®Œå…¨ç¦ç”¨æ—¥å¿—
- âœ… **æ‰©å±•æ€§**ï¼šæ˜“äºæ·»åŠ æ—¥å¿—ä¼ è¾“ï¼ˆHTTPã€WebSocketç­‰ï¼‰
- âœ… **ä¸Šä¸‹æ–‡ä¿¡æ¯**ï¼šè‡ªåŠ¨æ·»åŠ æ—¶é—´æˆ³ã€ç”¨æˆ·ä¿¡æ¯ã€è¯·æ±‚IDç­‰

**3. é¡¹ç›®è§„æ¨¡æ”¯æŒ**
- å¾®å‰ç«¯æ¶æ„ï¼Œå¤šä¸ªåº”ç”¨éœ€è¦ç»Ÿä¸€æ—¥å¿—è§„èŒƒ
- å·²æœ‰æ—¥å¿—ä¸ŠæŠ¥éœ€æ±‚ï¼ˆrequest-loggerï¼‰
- 5158 å¤„æ—¥å¿—è°ƒç”¨éœ€è¦ç»Ÿä¸€ç®¡ç†

---

## winston vs pino å¯¹æ¯”

### Winstonï¼ˆåŠŸèƒ½å…¨ã€æ˜“é…ç½®ï¼‰

#### ä¼˜ç‚¹ âœ…
- **åŠŸèƒ½ä¸°å¯Œ**ï¼šæ”¯æŒå¤šç§ä¼ è¾“æ–¹å¼ï¼ˆæ–‡ä»¶ã€HTTPã€æ•°æ®åº“ç­‰ï¼‰
- **æ˜“é…ç½®**ï¼šé…ç½®çµæ´»ï¼Œæ”¯æŒå¤šç¯å¢ƒé…ç½®
- **ç”Ÿæ€å®Œå–„**ï¼šå¤§é‡æ’ä»¶å’Œä¼ è¾“å™¨
- **TypeScript æ”¯æŒå¥½**ï¼šç±»å‹å®šä¹‰å®Œå–„
- **é€‚åˆå¤æ‚åœºæ™¯**ï¼šå¤šæ ¼å¼ã€å¤šç›®æ ‡è¾“å‡º

#### ç¼ºç‚¹ âŒ
- **ä½“ç§¯è¾ƒå¤§**ï¼š~200KBï¼ˆgzipped ~60KBï¼‰
- **æ€§èƒ½ä¸€èˆ¬**ï¼šåŒæ­¥æ—¥å¿—å¯èƒ½é˜»å¡äº‹ä»¶å¾ªç¯
- **é…ç½®å¤æ‚**ï¼šåŠŸèƒ½å¤šå¯¼è‡´é…ç½®é€‰é¡¹å¤š

#### é€‚ç”¨åœºæ™¯
- éœ€è¦å¤šç§æ—¥å¿—è¾“å‡ºæ–¹å¼
- éœ€è¦å¤æ‚çš„æ—¥å¿—æ ¼å¼è½¬æ¢
- éœ€è¦é›†æˆå¤šç§æ—¥å¿—æœåŠ¡
- å¯¹æ€§èƒ½è¦æ±‚ä¸æ˜¯ç‰¹åˆ«é«˜

---

### Pinoï¼ˆæ€§èƒ½å¿«ã€è½»é‡ï¼‰

#### ä¼˜ç‚¹ âœ…
- **æ€§èƒ½æä½³**ï¼šå¼‚æ­¥æ—¥å¿—ï¼Œä¸é˜»å¡ä¸»çº¿ç¨‹
- **ä½“ç§¯å°**ï¼š~50KBï¼ˆgzipped ~15KBï¼‰
- **é€Ÿåº¦å¿«**ï¼šæ¯” winston å¿« 5-10 å€
- **ç»“æ„åŒ–æ—¥å¿—**ï¼šé»˜è®¤ JSON æ ¼å¼
- **é…ç½®ç®€å•**ï¼šAPI ç®€æ´ï¼Œæ˜“äºä½¿ç”¨

#### ç¼ºç‚¹ âŒ
- **åŠŸèƒ½ç›¸å¯¹ç®€å•**ï¼šä¼ è¾“å™¨æ’ä»¶è¾ƒå°‘
- **ç”Ÿæ€è¾ƒå°**ï¼šæ’ä»¶å’Œç¤¾åŒºæ”¯æŒä¸å¦‚ winston
- **æµè§ˆå™¨æ”¯æŒ**ï¼šéœ€è¦ `pino-pretty` åœ¨å¼€å‘ç¯å¢ƒæ ¼å¼åŒ–

#### é€‚ç”¨åœºæ™¯
- é«˜æ€§èƒ½è¦æ±‚
- å¤§é‡æ—¥å¿—è¾“å‡º
- éœ€è¦è½»é‡çº§è§£å†³æ–¹æ¡ˆ
- ä¸»è¦ä½¿ç”¨ç»“æ„åŒ–æ—¥å¿—

---

## æ¨èæ–¹æ¡ˆ

### ğŸ¯ **æ¨èä½¿ç”¨ Pino**

#### ç†ç”±

1. **æ€§èƒ½ä¼˜åŠ¿**
   - å‰ç«¯åº”ç”¨å¯¹æ€§èƒ½æ•æ„Ÿ
   - 5158 å¤„æ—¥å¿—è°ƒç”¨ï¼Œæ€§èƒ½å½±å“æ˜æ˜¾
   - å¼‚æ­¥æ—¥å¿—ä¸é˜»å¡ UI æ¸²æŸ“

2. **ä½“ç§¯ä¼˜åŠ¿**
   - å¾®å‰ç«¯æ¶æ„ï¼Œä½“ç§¯æ•æ„Ÿ
   - Pino ä½“ç§¯ä»…ä¸º Winston çš„ 1/4

3. **é¡¹ç›®éœ€æ±‚åŒ¹é…**
   - å·²æœ‰æ—¥å¿—ä¸ŠæŠ¥æœºåˆ¶ï¼ˆrequest-loggerï¼‰
   - ä¸»è¦éœ€è¦ç»“æ„åŒ–æ—¥å¿—å’Œçº§åˆ«æ§åˆ¶
   - ä¸éœ€è¦å¤æ‚çš„å¤šä¼ è¾“å™¨é…ç½®

4. **è¿ç§»æˆæœ¬**
   - Pino API ç®€æ´ï¼Œè¿ç§»æ›´å®¹æ˜“
   - å¯ä»¥é€æ­¥æ›¿æ¢ `console.*` è°ƒç”¨

---

## å®æ–½å»ºè®®

### é˜¶æ®µä¸€ï¼šåŸºç¡€é›†æˆï¼ˆ1-2å¤©ï¼‰

1. **å®‰è£…ä¾èµ–**
```bash
pnpm add pino pino-pretty
pnpm add -D @types/pino
```

2. **åˆ›å»ºç»Ÿä¸€æ—¥å¿—æ¨¡å—**
```typescript
// packages/shared-core/src/utils/logger/index.ts
import pino from 'pino';

const logger = pino({
  level: import.meta.env.DEV ? 'debug' : 'warn',
  browser: {
    asObject: true,
    transmit: {
      level: 'info',
      send: (level, logEvent) => {
        // é›†æˆåˆ°ç°æœ‰çš„ request-logger
        // æˆ–å‘é€åˆ°æ—¥å¿—æœåŠ¡
      }
    }
  },
  ...(import.meta.env.DEV && {
    transport: {
      target: 'pino-pretty',
      options: {
        colorize: true,
        translateTime: 'SYS:standard',
      }
    }
  })
});

export default logger;
```

3. **åˆ›å»º ESLint è§„åˆ™**
```javascript
// .eslintrc.js
rules: {
  'no-console': ['warn', { 
    allow: ['warn', 'error'] 
  }],
  // æˆ–å®Œå…¨ç¦æ­¢ consoleï¼Œå¼ºåˆ¶ä½¿ç”¨ logger
}
```

### é˜¶æ®µäºŒï¼šé€æ­¥è¿ç§»ï¼ˆ1-2å‘¨ï¼‰

1. **ä¼˜å…ˆè¿ç§»å…³é”®æ¨¡å—**
   - HTTP è¯·æ±‚æ‹¦æˆªå™¨
   - é”™è¯¯å¤„ç†æ¨¡å—
   - æ ¸å¿ƒä¸šåŠ¡é€»è¾‘

2. **åˆ›å»ºè¿ç§»å·¥å…·**
   - è„šæœ¬è‡ªåŠ¨æ›¿æ¢ `console.log` â†’ `logger.info`
   - ä¿ç•™ `console.error` ç”¨äºç´§æ€¥é”™è¯¯

3. **ç»Ÿä¸€æ—¥å¿—æ ¼å¼**
   ```typescript
   // æ ‡å‡†æ—¥å¿—æ ¼å¼
   logger.info({ 
     userId, 
     action: 'user_login',
     metadata: {...} 
   }, 'User logged in');
   ```

### é˜¶æ®µä¸‰ï¼šå®Œå–„åŠŸèƒ½ï¼ˆæŒç»­ï¼‰

1. **é›†æˆæ—¥å¿—ä¸ŠæŠ¥**
   - ä¸ç°æœ‰ `request-logger` é›†æˆ
   - æ·»åŠ é”™è¯¯æ—¥å¿—è‡ªåŠ¨ä¸ŠæŠ¥

2. **æ·»åŠ æ—¥å¿—ä¸Šä¸‹æ–‡**
   - è¯·æ±‚ ID è¿½è¸ª
   - ç”¨æˆ·ä¿¡æ¯è‡ªåŠ¨æ³¨å…¥
   - æ€§èƒ½æŒ‡æ ‡è®°å½•

3. **æ—¥å¿—åˆ†æ**
   - å‰ç«¯æ—¥å¿—èšåˆ
   - é”™è¯¯è¶‹åŠ¿åˆ†æ
   - ç”¨æˆ·è¡Œä¸ºè¿½è¸ª

---

## æˆæœ¬æ•ˆç›Šåˆ†æ

### å¼•å…¥æˆæœ¬
- **å¼€å‘æ—¶é—´**ï¼š2-3 å‘¨ï¼ˆè¿ç§» + æµ‹è¯•ï¼‰
- **å­¦ä¹ æˆæœ¬**ï¼šä½ï¼ˆPino API ç®€å•ï¼‰
- **ç»´æŠ¤æˆæœ¬**ï¼šä½ï¼ˆç»Ÿä¸€ç®¡ç†ï¼‰

### æ”¶ç›Š
- âœ… **æ€§èƒ½æå‡**ï¼šå¼‚æ­¥æ—¥å¿—ï¼Œä¸é˜»å¡ UI
- âœ… **å¯ç»´æŠ¤æ€§**ï¼šç»Ÿä¸€æ—¥å¿—æ¥å£ï¼Œæ˜“äºç®¡ç†
- âœ… **å¯è§‚æµ‹æ€§**ï¼šç»“æ„åŒ–æ—¥å¿—ï¼Œä¾¿äºåˆ†æ
- âœ… **ç”Ÿäº§ç¯å¢ƒä¼˜åŒ–**ï¼šå¯å®Œå…¨ç¦ç”¨æ—¥å¿—ï¼Œå‡å°‘ä½“ç§¯
- âœ… **è°ƒè¯•æ•ˆç‡**ï¼šå¼€å‘ç¯å¢ƒæ ¼å¼åŒ–è¾“å‡ºï¼Œç”Ÿäº§ç¯å¢ƒç»“æ„åŒ–

---

## ç»“è®º

### âœ… **å¼ºçƒˆå»ºè®®å¼•å…¥ Pino**

**åŸå› **ï¼š
1. é¡¹ç›®è§„æ¨¡å¤§ï¼ˆ5158 å¤„æ—¥å¿—è°ƒç”¨ï¼‰ï¼Œéœ€è¦ç»Ÿä¸€ç®¡ç†
2. å·²æœ‰æ—¥å¿—ä¸ŠæŠ¥éœ€æ±‚ï¼Œéœ€è¦ç»“æ„åŒ–æ—¥å¿—
3. æ€§èƒ½æ•æ„Ÿï¼ˆå‰ç«¯åº”ç”¨ï¼‰ï¼ŒPino æ€§èƒ½ä¼˜åŠ¿æ˜æ˜¾
4. ä½“ç§¯æ•æ„Ÿï¼ˆå¾®å‰ç«¯ï¼‰ï¼ŒPino ä½“ç§¯æ›´å°
5. è¿ç§»æˆæœ¬å¯æ§ï¼Œå¯ä»¥é€æ­¥æ›¿æ¢

**ä¸å¼•å…¥çš„é£é™©**ï¼š
- ç”Ÿäº§ç¯å¢ƒæ—¥å¿—æ— æ³•æ§åˆ¶
- æ—¥å¿—æ ¼å¼ä¸ç»Ÿä¸€ï¼Œéš¾ä»¥åˆ†æ
- æ€§èƒ½å½±å“ï¼ˆå¤§é‡ console è°ƒç”¨ï¼‰
- ç»´æŠ¤å›°éš¾ï¼ˆåˆ†æ•£çš„ console è°ƒç”¨ï¼‰

---

## æ›¿ä»£æ–¹æ¡ˆ

å¦‚æœæš‚æ—¶ä¸å¼•å…¥æ—¥å¿—åº“ï¼Œå»ºè®®ï¼š

1. **åˆ›å»ºç®€å•çš„æ—¥å¿—åŒ…è£…å™¨**
```typescript
// ç®€å•çš„ logger åŒ…è£…ï¼Œä¿æŒ console API
const logger = {
  debug: (...args) => {
    if (import.meta.env.DEV) console.debug(...args);
  },
  info: (...args) => {
    if (import.meta.env.DEV) console.info(...args);
  },
  // ...
};
```

2. **é€æ­¥è§„èŒƒåŒ–**
   - ç»Ÿä¸€ä½¿ç”¨ `logger.*` è€Œä¸æ˜¯ `console.*`
   - ä¸ºåç»­è¿ç§»åšå‡†å¤‡

**ä½†è¿™ç§æ–¹å¼æ— æ³•è·å¾—**ï¼š
- ç»“æ„åŒ–æ—¥å¿—
- æ€§èƒ½ä¼˜åŒ–ï¼ˆå¼‚æ­¥ï¼‰
- æ—¥å¿—ä¼ è¾“èƒ½åŠ›
- å®Œæ•´çš„æ—¥å¿—çº§åˆ«æ§åˆ¶

---

## å®æ–½çŠ¶æ€

âœ… **å·²å®Œæˆå®æ–½**

æ—¥å¿—æ¨¡å—å·²æˆåŠŸåˆ›å»ºå¹¶é›†æˆåˆ°é¡¹ç›®ä¸­ï¼š

1. âœ… å·²å®‰è£… Pino å’Œ pino-pretty ä¾èµ–
2. âœ… å·²åˆ›å»ºæ—¥å¿—æ¨¡å—æ ¸å¿ƒæ–‡ä»¶ï¼ˆtypes.ts, pino-config.ts, transports.ts, index.tsï¼‰
3. âœ… å·²é›†æˆåˆ°ç°æœ‰çš„ request-logger ä¸ŠæŠ¥ç³»ç»Ÿ
4. âœ… å·²é…ç½® ESLint è§„åˆ™ï¼Œç¦æ­¢æ–°çš„ console è°ƒç”¨
5. âœ… å·²è¿ç§»å…³é”®æ¨¡å—ï¼ˆerror-monitor, httpï¼‰çš„ console è°ƒç”¨
6. âœ… å·²åˆ›å»ºä½¿ç”¨æ–‡æ¡£å’Œè¿ç§»æŒ‡å—

### ä½¿ç”¨æ–¹å¼

```typescript
import { logger } from '@btc/shared-core';

logger.info('ç”¨æˆ·ç™»å½•', { userId: 123 });
logger.error('æ“ä½œå¤±è´¥', error);
```

è¯¦ç»†æ–‡æ¡£è¯·å‚è€ƒï¼š[packages/shared-core/src/utils/logger/README.md](packages/shared-core/src/utils/logger/README.md)

## å‚è€ƒèµ„æ–™

- [Pino å®˜æ–¹æ–‡æ¡£](https://getpino.io/)
- [Winston å®˜æ–¹æ–‡æ¡£](https://github.com/winstonjs/winston)
- [å‰ç«¯æ—¥å¿—æœ€ä½³å®è·µ](https://developer.mozilla.org/en-US/docs/Web/API/Console)
- [æ—¥å¿—æ¨¡å—ä½¿ç”¨æ–‡æ¡£](packages/shared-core/src/utils/logger/README.md)
