# 发布推送指南

## 概述

`release:push` 是一个简化的发布推送命令，可以一键完成版本发布的整个流程，包括创建 release 分支、创建标签、更新 CHANGELOG 和推送到远程。

## 使用方式

### 常规推送（正常开发流程）

```bash
# 常规推送，使用标准 commit
git add .
git commit -m "feat: add new feature"
git push
```

### 发布推送（版本发布流程）

```bash
# 使用发布推送命令
pnpm release:push
```

或者直接运行脚本：

```bash
node scripts/release-push.mjs
```

## 发布推送流程

运行 `pnpm release:push` 后，脚本会引导你完成以下步骤：

### 1. 检查当前分支
- 建议在 `develop` 分支运行
- 如果不在 develop，会询问是否继续

### 2. 检查工作区状态
- 检查是否有未提交的更改
- 如果有，会提示先提交

### 3. 拉取最新代码
- 询问是否拉取最新代码
- 确保本地代码是最新的

### 4. 输入版本信息
- 输入版本号（如 `1.0.8`）
- 自动验证版本号格式

### 5. 输入标签消息
- 输入版本描述/标签消息
- 支持多行输入
- 可以直接回车使用默认消息

### 6. 确认信息
- 显示所有信息供确认
- 确认后开始执行

### 7. 更新版本号（可选）
- 自动更新 `package.json` 中的版本号
- 提交版本号更改

### 8. 创建 release 分支
- 自动创建 `release/v1.0.8` 分支
- 如果分支已存在，询问是否删除重建

### 9. 推送到远程
- 推送 release 分支到远程

### 10. 合并到 main 分支
- 切换到 main 分支
- 合并 release 分支
- 创建标签
- 自动更新 CHANGELOG.md

### 11. 合并回 develop
- 切换回 develop 分支
- 合并 release 分支

### 12. 推送所有更改
- 推送 main 分支
- 推送 develop 分支
- 推送标签

### 13. 清理 release 分支
- 删除本地和远程的 release 分支

## 完整示例

```bash
# 1. 确保在 develop 分支
git checkout develop

# 2. 运行发布推送命令
pnpm release:push

# 3. 按照提示操作：
#    - 输入版本号: 1.0.8
#    - 输入标签消息: 版本 v1.0.8
#      主要更新:
#      - 新增功能 A
#      - 修复问题 B
#    - 确认所有信息
#    - 选择是否更新版本号
#    - 选择是否合并到 main
#    - 选择是否推送
```

## 与常规 push 的区别

| 操作 | 常规 push | 发布 push |
|------|----------|-----------|
| 命令 | `git push` | `pnpm release:push` |
| 用途 | 正常开发推送 | 版本发布 |
| 分支 | 当前分支 | 自动创建 release 分支 |
| 标签 | 不创建 | 自动创建版本标签 |
| CHANGELOG | 不更新 | 自动更新 |
| 流程 | 简单推送 | 完整发布流程 |

## 优势

1. **简化流程**：一键完成所有发布步骤
2. **交互式引导**：每个步骤都有提示和确认
3. **自动更新**：自动更新版本号和 CHANGELOG
4. **安全可靠**：每个关键步骤都有确认提示
5. **灵活控制**：可以选择跳过某些步骤

## 注意事项

1. **建议在 develop 分支运行**：虽然不强制，但建议在 develop 分支运行
2. **工作区干净**：运行前确保工作区没有未提交的重要更改
3. **版本号格式**：必须遵循语义化版本规范（x.y.z）
4. **标签消息**：建议填写详细的版本描述，会显示在 CHANGELOG 中
5. **GitHub Release**：脚本完成后，建议在 GitHub 上创建 Release 并填写详细说明

## 常见问题

### Q: 如果发布流程中断了怎么办？

A: 脚本会在每个步骤检查状态，如果中断：
1. 检查当前分支状态：`git status`
2. 根据错误信息修复问题
3. 重新运行脚本或手动执行剩余步骤

### Q: 可以只创建标签不合并到 main 吗？

A: 可以，在步骤 10 选择"否"即可。但建议按照标准流程执行。

### Q: 如何跳过某些步骤？

A: 脚本是交互式的，可以在每个步骤选择跳过或取消。但建议按照标准流程执行。

### Q: 如果 release 分支已存在怎么办？

A: 脚本会检测到已存在的分支，并询问是否删除重建。如果分支中有重要更改，建议先手动处理。

## 相关文档

- [Git 标签规范指南](./GIT_TAG_GUIDE.md)
- [版本发布指南](./VERSION_RELEASE_GUIDE.md)
- [Git 提交规范](./CONTRIBUTING.md#git-提交规范)
