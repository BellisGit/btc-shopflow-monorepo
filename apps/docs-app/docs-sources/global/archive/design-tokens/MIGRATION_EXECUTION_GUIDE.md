# 迁移执行指南

本文档提供迁移执行的详细指南，确保每一步都能独立、正确地执行。

## 快速开始

### 1. 阅读文档

在执行迁移前，请先阅读：
- [MIGRATION_ATOMIC_STEPS.md](./MIGRATION_ATOMIC_STEPS.md) - 原子化步骤文档
- [MIGRATION_MILESTONES.md](./MIGRATION_MILESTONES.md) - 里程碑文档

### 2. 准备环境

确保以下环境已准备：
- Node.js >= 20.19.0
- pnpm >= 8.0.0
- Git（用于版本控制）

### 3. 创建分支

```bash
git checkout -b feat/design-tokens-migration
```

## 执行流程

### 阶段1：设计令牌包构建和验证

**目标里程碑**：M1 - 设计令牌包就绪

**执行步骤**：
1. 按照 [MIGRATION_ATOMIC_STEPS.md](./MIGRATION_ATOMIC_STEPS.md) 中的步骤1.1-1.4执行
2. 完成每个步骤后，在文档中标记完成
3. 完成所有步骤后，验证里程碑M1的完成标准

**检查点**：
- [ ] 步骤1.1完成：依赖已安装
- [ ] 步骤1.2完成：构建成功，输出文件生成
- [ ] 步骤1.3完成：变量名格式正确
- [ ] 步骤1.4完成：变量值正确
- [ ] 里程碑M1完成：所有完成标准满足

**提交代码**：
```bash
git add packages/design-tokens/
git commit -m "feat(design-tokens): 完成设计令牌包构建和验证 [M1]"
```

---

### 阶段2：集成到 shared-components

**目标里程碑**：M2 - 设计令牌包集成完成

**执行步骤**：
1. 按照步骤2.1-2.5执行
2. 每完成一个步骤，立即验证
3. 完成所有步骤后，验证里程碑M2的完成标准

**检查点**：
- [ ] 步骤2.1完成：依赖已添加
- [ ] 步骤2.2完成：依赖已安装
- [ ] 步骤2.3完成：_tokens.scss 已更新
- [ ] 步骤2.4完成：构建成功
- [ ] 步骤2.5完成：浏览器中变量正确加载
- [ ] 里程碑M2完成：所有完成标准满足

**提交代码**：
```bash
git add packages/shared-components/package.json packages/shared-components/src/styles/_tokens.scss
git commit -m "feat(shared-components): 集成设计令牌包 [M2]"
```

---

### 阶段3：变量迁移（批次1）

**目标里程碑**：M3 - 核心样式文件迁移完成

**执行步骤**：
1. 按照步骤3.1.1-3.1.4迁移 `crud/_base.scss`
2. 按照步骤3.2.1-3.2.4迁移 `crud/_button.scss`
3. 按照步骤3.3.1-3.3.4迁移 `_components.scss`
4. 执行步骤3.4进行完整验证
5. 验证里程碑M3的完成标准

**检查点**：
- [ ] crud/_base.scss 迁移完成
- [ ] crud/_button.scss 迁移完成
- [ ] _components.scss 迁移完成
- [ ] 批次1完整验证通过
- [ ] 里程碑M3完成：所有完成标准满足

**提交代码**：
```bash
git add packages/shared-components/src/styles/crud/_base.scss packages/shared-components/src/styles/crud/_button.scss packages/shared-components/src/styles/_components.scss
git commit -m "feat(shared-components): 迁移核心样式文件到设计令牌 [M3]"
```

---

### 阶段4-6：继续迁移

按照相同的流程，完成批次2、批次3、批次4的迁移。

每个批次完成后：
1. 验证批次完整性
2. 验证对应里程碑
3. 提交代码

---

### 阶段7：全面测试

**目标里程碑**：M7 - 全面测试完成

**执行步骤**：
1. 按照步骤7.1-7.5执行所有测试
2. 记录测试结果
3. 如有问题，修复后重新测试

**检查点**：
- [ ] 功能测试通过
- [ ] 主题切换测试通过
- [ ] 跨应用测试通过
- [ ] 性能测试通过
- [ ] 里程碑M7完成：所有完成标准满足

---

### 阶段8：文档更新

**目标里程碑**：M8 - 文档更新和清理完成

**执行步骤**：
1. 按照步骤8.1-8.4更新文档
2. 创建迁移总结
3. 清理冗余代码（如需要）

**检查点**：
- [ ] 所有文档已更新
- [ ] 迁移总结已创建
- [ ] 代码已清理
- [ ] 里程碑M8完成：所有完成标准满足

---

## 执行原则

### 1. 一次只执行一个步骤

- 不要同时执行多个步骤
- 完成一个步骤后，验证通过再进行下一步

### 2. 充分验证

- 每个步骤完成后都要验证
- 每个里程碑完成后都要全面验证

### 3. 及时提交

- 每个里程碑完成后提交代码
- 使用清晰的提交信息，包含里程碑标记

### 4. 记录问题

- 遇到问题及时记录
- 分析问题原因
- 记录解决方案

### 5. 保持沟通

- 里程碑完成及时沟通
- 遇到阻塞问题及时沟通
- 进度更新及时沟通

## 问题处理

### 问题类型1：构建失败

**症状**：执行 `pnpm build` 失败

**处理步骤**：
1. 查看错误信息
2. 检查配置文件
3. 检查令牌文件格式
4. 修复问题
5. 重新构建

### 问题类型2：样式异常

**症状**：迁移后样式显示异常

**处理步骤**：
1. 检查变量名是否正确
2. 检查变量值是否正确
3. 检查浏览器开发者工具
4. 对比迁移前后的样式
5. 修复问题

### 问题类型3：功能异常

**症状**：迁移后功能异常

**处理步骤**：
1. 检查是否误删了代码
2. 检查变量引用是否正确
3. 使用 git diff 对比更改
4. 修复问题

## 回滚操作

### 回滚单个步骤

如果某个步骤失败，可以回滚：

```bash
# 查看更改
git status

# 回滚特定文件
git checkout -- <file>

# 或回滚所有更改
git reset --hard HEAD
```

### 回滚整个里程碑

如果某个里程碑验证失败：

```bash
# 查看里程碑对应的提交
git log --oneline

# 回滚到里程碑前的提交
git reset --hard <commit-hash>
```

## 进度跟踪

### 使用文档标记

在 [MIGRATION_ATOMIC_STEPS.md](./MIGRATION_ATOMIC_STEPS.md) 中：
- 完成步骤后，将 `[ ]` 改为 `[x]`
- 在步骤后添加完成时间

### 使用里程碑文档

在 [MIGRATION_MILESTONES.md](./MIGRATION_MILESTONES.md) 中：
- 更新里程碑状态
- 记录完成时间
- 记录备注

### 使用版本控制

- 每个里程碑完成后提交代码
- 使用清晰的提交信息
- 使用里程碑标记（如 `[M1]`）

## 成功标准

迁移成功完成的标准：

1. **所有里程碑已完成**：M1-M8 全部完成
2. **所有测试通过**：功能测试、主题测试、跨应用测试、性能测试
3. **文档已更新**：架构文档、集成指南、迁移总结
4. **代码已清理**：冗余代码已移除
5. **无回归问题**：现有功能正常，无破坏性更改

## 时间估算

| 阶段 | 预计时间 | 累计时间 |
|------|---------|---------|
| 阶段1：设计令牌包构建 | 0.5-1天 | 0.5-1天 |
| 阶段2：集成到 shared-components | 0.5-1天 | 1-2天 |
| 阶段3：批次1迁移 | 2-3天 | 3-5天 |
| 阶段4：批次2迁移 | 3-4天 | 6-9天 |
| 阶段5：批次3迁移 | 3-4天 | 9-13天 |
| 阶段6：批次4迁移 | 2-4天 | 11-17天 |
| 阶段7：全面测试 | 5-7天 | 16-24天 |
| 阶段8：文档更新 | 1-2天 | 17-26天 |

**总预计时间**：17-26天（约3.5-5周）

## 注意事项

1. **不要急于求成**：每个步骤都要充分验证
2. **保持代码整洁**：及时提交，使用清晰的提交信息
3. **记录问题**：遇到问题及时记录和解决
4. **保持沟通**：进度和问题及时沟通

## 获取帮助

如果遇到问题：

1. **查阅文档**：先查阅相关文档
2. **检查配置**：检查配置文件和令牌文件
3. **查看日志**：查看构建日志和错误信息
4. **寻求帮助**：及时寻求帮助
