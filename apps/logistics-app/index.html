<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" href="/logo.png" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>物流应用 - BTC ShopFlow</title>
  </head>
  <body>
    <!-- 布局微应用的挂载点 -->
    <div id="layout-container"></div>
    <!-- 子应用独立运行容器（仅本地调试使用） -->
    <div id="app"></div>
    <script>
      (function () {
        // 关键：如果已经在 qiankun 环境中（由主应用加载），不执行任何独立运行逻辑
        // 生产环境：主应用通过 /micro-apps/logistics/ 路径加载，此时不应该加载 layout-app
        if (window.__POWERED_BY_QIANKUN__ || window.location.pathname.startsWith('/micro-apps/')) {
          return;
        }

        // 仅本地开发环境或独立访问子域名时，才加载 layout-app
        // 生产环境：子域名应该代理到主应用，不应该直接访问子应用的 index.html
        var shouldLoadLayout = /\.bellis\.com\.cn$/i.test(window.location.hostname);
        if (!shouldLoadLayout) {
          return;
        }

        var LOADER_FLAG = '__layout_app_loader__';
        if (window[LOADER_FLAG]) {
          return;
        }
        window[LOADER_FLAG] = true;
        window.__USE_LAYOUT_APP__ = true;

        // 使用共享工具函数加载 layout-app（需要先安装 qiankun 依赖）
        // 这样可以避免 CDN 的 CORS 问题和网络问题
        // 注意：qiankun 需要在 logistics-app 的 package.json 中安装
        import('../../packages/shared-utils/src/qiankun/load-layout-app.ts')
          .then(({ loadLayoutApp }) => {
            return loadLayoutApp();
          })
          .catch((error) => {
            console.error('[logistics-app] 加载 layout-app 失败:', error);
          });
      })();
    </script>
    <script type="module" src="/src/main.ts"></script>
  </body>
</html>

