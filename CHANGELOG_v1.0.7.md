# ç‰ˆæœ¬æ›´æ–°è¯´æ˜ v1.0.7

**å‘å¸ƒæ—¥æœŸ**: 2025-01-XX

## ğŸ¯ ä¸»è¦æ›´æ–°

### âœ¨ å­˜å‚¨ç³»ç»Ÿé‡æ„ï¼ˆæ ¸å¿ƒåŠŸèƒ½ï¼‰

#### 1. å¼•å…¥ Pinia æŒä¹…åŒ–æ’ä»¶
- **æ–°å¢ä¾èµ–**: `pinia-plugin-persistedstate@^3.2.0`
- **ç»Ÿä¸€ç®¡ç†**: æ‰€æœ‰ Pinia Store çš„æŒä¹…åŒ–ç»Ÿä¸€ä½¿ç”¨æ’ä»¶ç®¡ç†
- **ç®€åŒ–ä»£ç **: ç§»é™¤äº†æ‰€æœ‰æ‰‹åŠ¨å®ç°çš„æŒä¹…åŒ–é€»è¾‘ï¼Œä»£ç æ›´ç®€æ´

#### 2. å­˜å‚¨å·¥å…·ç›®å½•é‡ç»„
- **ç»Ÿä¸€ç›®å½•**: æ‰€æœ‰å­˜å‚¨å·¥å…·ç»Ÿä¸€åˆ° `packages/shared-core/src/utils/storage/` ç›®å½•
- **Cookie å·¥å…·**: ä» `utils/cookie/` ç§»åŠ¨åˆ° `utils/storage/cookie/`
- **LocalStorage å·¥å…·**: é‡æ„ä¸º `utils/storage/local/`
- **SessionStorage å·¥å…·**: æ–°å»º `utils/storage/session/`ï¼Œæä¾›ç»Ÿä¸€çš„ sessionStorage æ“ä½œæ¥å£
- **Pinia æ’ä»¶é…ç½®**: æ–°å»º `utils/storage/pinia-persist/`ï¼Œæä¾›ç»Ÿä¸€çš„æŒä¹…åŒ–æ’ä»¶é…ç½®

#### 3. é‡æ„ Store æŒä¹…åŒ–
- **useProcessStore**: ç§»é™¤æ‰‹åŠ¨æŒä¹…åŒ–é€»è¾‘ï¼Œä½¿ç”¨ `pinia-plugin-persistedstate`
  - è‡ªåŠ¨æŒä¹…åŒ– `list` å’Œ `pinned` å­—æ®µ
  - æ’é™¤ `active` çŠ¶æ€ï¼ˆåˆ·æ–°åé‡æ–°è®¡ç®—ï¼‰
  - æ”¯æŒæ•°æ®éªŒè¯å’Œæ¸…ç†é’©å­
- **useRecentAccessStore**: ç§»é™¤æ‰‹åŠ¨æŒä¹…åŒ–é€»è¾‘ï¼Œä½¿ç”¨æ’ä»¶è‡ªåŠ¨ç®¡ç†
  - è‡ªåŠ¨æŒä¹…åŒ– `items` å­—æ®µ
  - æ”¯æŒæ•°æ®éªŒè¯å’Œæ¸…ç†

#### 4. é‡æ„ç›´æ¥ä½¿ç”¨å­˜å‚¨çš„ä»£ç 
- **useUserCheckStorage**: ä½¿ç”¨ç»Ÿä¸€çš„ sessionStorage å·¥å…·æ›¿ä»£åŸç”Ÿ API
- **è·¯ç”±å®ˆå«**: `logoutGuard` å’Œ `loginRedirectGuard` ä½¿ç”¨ç»Ÿä¸€çš„ sessionStorage å·¥å…·
- **é€€å‡ºç™»å½•é€»è¾‘**: `logoutCore` å’Œ `useSubAppLogout` ä½¿ç”¨ç»Ÿä¸€çš„å­˜å‚¨å·¥å…·
- **å¯¼èˆªæ ‡è®°**: èœå•æŠ½å±‰ç»„ä»¶ä½¿ç”¨ç»Ÿä¸€çš„ sessionStorage å·¥å…·

#### 5. æ–°å¢ IndexedDB å·¥å…·ï¼ˆå¯è§†åŒ–çœ‹æ¿æ”¯æŒï¼‰
- **æ–°å¢ä¾èµ–**: `dexie@^4.2.1`
- **æ•°æ®åº“åç§°**: `BTCDashboardDB`ï¼ˆé»˜è®¤çœ‹æ¿æ•°æ®åº“ï¼‰
- **é»˜è®¤è¡¨ç»“æ„**: `dashboardData` è¡¨ï¼Œæ”¯æŒ `time`ã€`operator`ã€`type`ã€`category` ç­‰ç´¢å¼•å­—æ®µ
- **æ ¸å¿ƒåŠŸèƒ½**:
  - é«˜æ•ˆçš„ç´¢å¼•å’ŒèŒƒå›´æŸ¥è¯¢ï¼ˆæ—¶é—´èŒƒå›´ã€æ“ä½œäººã€ç±»å‹ç­›é€‰ï¼‰
  - æ”¯æŒè‡ªå®šä¹‰æ•°æ®åº“å’Œè¡¨ç»“æ„
  - Vue3 å“åº”å¼æŸ¥è¯¢æ”¯æŒï¼ˆæ‰‹åŠ¨å®ç° `useLiveQuery`ï¼‰
  - æ‰¹é‡æ“ä½œæ”¯æŒï¼ˆ`batchAdd`ã€`batchUpdate`ã€`batchDelete`ï¼‰
  - ä¾¿æ·æŸ¥è¯¢æ–¹æ³•ï¼ˆ`queryByTimeRange`ã€`queryByOperator`ã€`queryByType` ç­‰ï¼‰
- **é€‚ç”¨åœºæ™¯**: å¯è§†åŒ–çœ‹æ¿/å¤§å±ã€æ•°æ®å›æ”¶ç«™ã€é”™è¯¯æ•°æ®è¡¨ã€è´¨é‡æ£€æŸ¥æŠ¥è¡¨ç­‰å¤§å®¹é‡æ•°æ®åœºæ™¯

#### 6. å­˜å‚¨å·¥å…·æ–‡æ¡£
- **Cookie ä½¿ç”¨æ–‡æ¡£**: `utils/storage/cookie/README.md`
- **SessionStorage ä½¿ç”¨æ–‡æ¡£**: `utils/storage/session/README.md`
- **IndexedDB ä½¿ç”¨æ–‡æ¡£**: `utils/storage/indexeddb/README.md`

### ğŸ› Bug ä¿®å¤

#### åº”ç”¨åˆ‡æ¢å’Œè·¯ç”±é—®é¢˜
- ä¿®å¤åº”ç”¨åˆ‡æ¢å’Œè·¯ç”±æ¸²æŸ“é—®é¢˜
- ä¿®å¤å­åº”ç”¨ loading ä¸åœæ­¢é—®é¢˜
- ä¿®å¤ç®¡ç†åº”ç”¨èœå•åˆ‡æ¢å¡é¡¿é—ªçƒé—®é¢˜
- ä¿®å¤ç”Ÿäº§ç¯å¢ƒå­åº”ç”¨å†…å®¹æŒ‚è½½å¤±è´¥é—®é¢˜
- ä¿®å¤å­åº”ç”¨ç™»å½•è·³è½¬é€»è¾‘ï¼Œç»Ÿä¸€è·³è½¬åˆ°ä¸»åŸŸåç™»å½•é¡µ
- ä¿®å¤å­åº”ç”¨é‡å®šå‘å’Œç‰©æµåº”ç”¨é¡µé¢æ¸²æŸ“é—®é¢˜

#### æ„å»ºå’Œéƒ¨ç½²é—®é¢˜
- ä¿®å¤ Jenkins æ„å»ºæ—¶ rollup.config å¯¼å…¥è·¯å¾„è§£æé—®é¢˜
- ä¿®å¤å…¨é‡æ„å»ºä¸­å…±äº«ä¾èµ–åŒ…é“¾æ¥é—®é¢˜
- ä¿®å¤ Docker æ£€æµ‹é€»è¾‘ï¼Œæ·»åŠ  Docker socket æ£€æŸ¥å’Œæ›´æ˜ç¡®çš„é”™è¯¯æç¤º
- ä¿®å¤éƒ¨ç½²è„šæœ¬ä¸­ç¼ºå¤±çš„åº”ç”¨ï¼ˆdashboard-appã€operations-appã€personnel-appï¼‰

#### å…¶ä»–ä¿®å¤
- ä¿®å¤åº”ç”¨çº§åŠ è½½æ˜¾ç¤ºé—®é¢˜ï¼Œç¡®ä¿æ­£ç¡®æ˜¾ç¤ºæ¨¡å—åç§°
- ä¿®å¤é€šè¿‡æ±‰å ¡èœå•åˆ‡æ¢åº”ç”¨æ—¶çš„ç™½å±å’Œç©ºåŠ è½½é—®é¢˜

### ğŸš€ åŠŸèƒ½å¢å¼º

#### è·¯ç”±æŒä¹…åŒ–
- ä¸ºæ‰€æœ‰å­åº”ç”¨æ·»åŠ  keep-alive è·¯ç”±æŒä¹…åŒ–
- ä¼˜åŒ–è·¯ç”±åˆ‡æ¢ä½“éªŒ

#### Jenkins æ„å»ºä¼˜åŒ–
- ä¸ºæ‰€æœ‰ Jenkinsfile æ·»åŠ  Poll SCM è‡ªåŠ¨è§¦å‘å™¨
- ä¸ºæ‰€æœ‰ Jenkins æ„å»ºè„šæœ¬æ·»åŠ  NodeJS Plugin æ”¯æŒ
- ä¼˜åŒ– Jenkins æ„å»ºé…ç½®å’Œæ·»åŠ è‡ªåŠ¨è§¦å‘åŠŸèƒ½
- æ·»åŠ  Jenkins OSS å‡­è¯é…ç½®æ”¯æŒ
- æ›´æ–°æ‰€æœ‰ Jenkins æ„å»ºè„šæœ¬çš„é»˜è®¤å‚æ•°é…ç½®
- ä¼˜åŒ–ä¾èµ–å®‰è£…ï¼Œä½¿ç”¨ `--prefer-offline` ä¼˜å…ˆä½¿ç”¨ç¼“å­˜
- æ›´æ–° Jenkinsfile.all-apps æ”¯æŒå¹¶è¡Œéƒ¨ç½² 10 ä¸ªåº”ç”¨ï¼Œä½¿ç”¨ Matrix Strategy

#### Docker éƒ¨ç½²å¢å¼º
- æ·»åŠ  home-app å’Œ layout-app çš„ Docker éƒ¨ç½² Jenkins è„šæœ¬
- æ·»åŠ  CDN åŠ é€Ÿå‚æ•°æ”¯æŒï¼Œé»˜è®¤å¯ç”¨ CDN åŠ é€Ÿ
- ç§»é™¤ ENABLE_CDN å’Œ ENABLE_CDN_UPLOAD å‚æ•°ï¼Œé»˜è®¤å¯ç”¨ CDN ä¸Šä¼ 
- æ·»åŠ  Windows Docker ç¯å¢ƒä¸‹é…ç½® SSH å¯†é’¥çš„ PowerShell è„šæœ¬
- åœ¨ Docker éƒ¨ç½²æŒ‡å—ä¸­æ·»åŠ  Jenkins å®¹å™¨é…ç½®è¯´æ˜

### ğŸ“ ä»£ç ä¼˜åŒ–

#### å­˜å‚¨å·¥å…·ä¼˜åŒ–
- ç»Ÿä¸€å­˜å‚¨å·¥å…· APIï¼Œä¿æŒä¸€è‡´çš„æ¥å£è®¾è®¡
- ä¼˜åŒ–é”™è¯¯å¤„ç†å’Œæ—¥å¿—è®°å½•
- æä¾›å‘åå…¼å®¹çš„å¯¼å…¥è·¯å¾„

#### æ„å»ºé…ç½®ä¼˜åŒ–
- å°† rollup.config å’Œ manual-chunks ç§»åŠ¨åˆ° plugins ç›®å½•
- ä¼˜åŒ– esbuild è§£æé…ç½®

## ğŸ“¦ ä¾èµ–æ›´æ–°

### æ–°å¢ä¾èµ–
- `pinia-plugin-persistedstate@^3.2.0` - Pinia æŒä¹…åŒ–æ’ä»¶
- `dexie@^4.2.1` - IndexedDB å°è£…åº“

### ä¾èµ–æ›´æ–°
- æ— é‡å¤§ç‰ˆæœ¬æ›´æ–°

## ğŸ”„ è¿ç§»æŒ‡å—

### å­˜å‚¨å·¥å…·å¯¼å…¥è·¯å¾„å˜æ›´

**æ—§è·¯å¾„**:
```typescript
import { getCookie } from '@btc/shared-core/utils/cookie';
```

**æ–°è·¯å¾„**ï¼ˆæ¨èï¼‰:
```typescript
import { getCookie } from '@btc/shared-core/utils/storage/cookie';
// æˆ–ä½¿ç”¨ç»Ÿä¸€å¯¼å‡º
import { getCookie } from '@btc/shared-core/utils/storage';
```

**å‘åå…¼å®¹**: æ—§çš„å¯¼å…¥è·¯å¾„ä»ç„¶å¯ç”¨ï¼Œä½†å»ºè®®è¿ç§»åˆ°æ–°è·¯å¾„ã€‚

### Store æŒä¹…åŒ–è¿ç§»

**æ—§æ–¹å¼**ï¼ˆæ‰‹åŠ¨æŒä¹…åŒ–ï¼‰:
```typescript
const persistenceUtils = {
  save(data) { /* ... */ },
  load() { /* ... */ },
  clear() { /* ... */ },
};
```

**æ–°æ–¹å¼**ï¼ˆä½¿ç”¨æ’ä»¶ï¼‰:
```typescript
export const useMyStore = defineStore('myStore', () => {
  const data = ref({});
  return { data };
}, {
  persist: {
    paths: ['data'],
  },
});
```

### SessionStorage ä½¿ç”¨è¿ç§»

**æ—§æ–¹å¼**:
```typescript
sessionStorage.setItem('key', value);
const value = sessionStorage.getItem('key');
sessionStorage.removeItem('key');
```

**æ–°æ–¹å¼**:
```typescript
import { sessionStorage } from '@btc/shared-core/utils/storage/session';

sessionStorage.set('key', value);
const value = sessionStorage.get('key');
sessionStorage.remove('key');
```

## ğŸ“š æ–‡æ¡£æ›´æ–°

- æ–°å¢ Cookie å·¥å…·ä½¿ç”¨æ–‡æ¡£
- æ–°å¢ SessionStorage å·¥å…·ä½¿ç”¨æ–‡æ¡£
- æ–°å¢ IndexedDB å·¥å…·ä½¿ç”¨æ–‡æ¡£
- æ›´æ–°ä¸» READMEï¼Œæ·»åŠ å­˜å‚¨å·¥å…·è¯´æ˜

## ğŸ¨ UI/UX æ”¹è¿›

- ä¼˜åŒ–åº”ç”¨çº§åŠ è½½ä½“éªŒ
- ä¿®å¤èœå•åˆ‡æ¢å¡é¡¿é—®é¢˜
- ä¼˜åŒ–è·¯ç”±åˆ‡æ¢åŠ¨ç”»

## ğŸ”§ æŠ€æœ¯å€ºåŠ¡æ¸…ç†

- ç§»é™¤æ‰€æœ‰æ‰‹åŠ¨å®ç°çš„æŒä¹…åŒ–é€»è¾‘
- ç»Ÿä¸€å­˜å‚¨å·¥å…·çš„ä½¿ç”¨æ–¹å¼
- æ¸…ç†æœªä½¿ç”¨çš„å¯¼å…¥å’Œä»£ç 

## ğŸ“Š ç»Ÿè®¡ä¿¡æ¯

- **ä¿®æ”¹æ–‡ä»¶æ•°**: 200+ æ–‡ä»¶
- **æ–°å¢æ–‡ä»¶æ•°**: 15+ æ–‡ä»¶
- **åˆ é™¤æ–‡ä»¶æ•°**: 30+ æ–‡ä»¶
- **ä»£ç è¡Œæ•°å˜åŒ–**: +2000 / -1500

## âš ï¸ ç ´åæ€§å˜æ›´

### å­˜å‚¨å·¥å…·è·¯å¾„å˜æ›´ï¼ˆå‘åå…¼å®¹ï¼‰
- Cookie å·¥å…·ä» `utils/cookie` ç§»åŠ¨åˆ° `utils/storage/cookie`
- æ—§è·¯å¾„ä»ç„¶å¯ç”¨ï¼Œä½†å»ºè®®è¿ç§»åˆ°æ–°è·¯å¾„

### Store æŒä¹…åŒ–æ–¹å¼å˜æ›´
- æ‰€æœ‰ä½¿ç”¨æ‰‹åŠ¨æŒä¹…åŒ–çš„ Store å·²è¿ç§»åˆ° `pinia-plugin-persistedstate`
- æ•°æ®æ ¼å¼ä¿æŒå…¼å®¹ï¼Œæ— éœ€æ•°æ®è¿ç§»

## ğŸ¯ ä¸‹ä¸€æ­¥è®¡åˆ’

- ç»§ç»­ä¼˜åŒ– IndexedDB å·¥å…·ï¼Œæ”¯æŒæ›´å¤šæŸ¥è¯¢åœºæ™¯
- å®Œå–„å­˜å‚¨å·¥å…·çš„ç±»å‹å®šä¹‰
- æ·»åŠ æ›´å¤šä½¿ç”¨ç¤ºä¾‹å’Œæœ€ä½³å®è·µ

---

**å®Œæ•´æ›´æ–°åˆ—è¡¨**: æŸ¥çœ‹ [Git æäº¤å†å²](https://github.com/BellisGit/btc-shopflow-monorepo/compare/v1.0.6...develop)
