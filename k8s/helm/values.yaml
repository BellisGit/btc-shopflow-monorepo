# BTC ShopFlow Helm Values

# 全局配置
global:
  imageRegistry: ""
  imagePullSecrets: []
  storageClass: ""

# 命名空间
namespace: btc-shopflow

# 镜像配置
image:
  registry: ""
  repository: btc-shopflow
  tag: latest
  pullPolicy: Always

# 应用配置
apps:
  system:
    enabled: true
    name: system-app
    port: 8080
    replicas: 2
    resources:
      requests:
        memory: "64Mi"
        cpu: "50m"
      limits:
        memory: "256Mi"
        cpu: "200m"
    autoscaling:
      enabled: true
      minReplicas: 2
      maxReplicas: 10
      targetCPUUtilizationPercentage: 70
      targetMemoryUtilizationPercentage: 80

  admin:
    enabled: true
    name: admin-app
    port: 8081
    replicas: 2
    resources:
      requests:
        memory: "64Mi"
        cpu: "50m"
      limits:
        memory: "256Mi"
        cpu: "200m"
    autoscaling:
      enabled: true
      minReplicas: 2
      maxReplicas: 8
      targetCPUUtilizationPercentage: 70
      targetMemoryUtilizationPercentage: 80

  logistics:
    enabled: true
    name: logistics-app
    port: 8082
    replicas: 2
    resources:
      requests:
        memory: "64Mi"
        cpu: "50m"
      limits:
        memory: "256Mi"
        cpu: "200m"
    autoscaling:
      enabled: true
      minReplicas: 2
      maxReplicas: 6
      targetCPUUtilizationPercentage: 70
      targetMemoryUtilizationPercentage: 80

  quality:
    enabled: true
    name: quality-app
    port: 8083
    replicas: 1
    resources:
      requests:
        memory: "32Mi"
        cpu: "25m"
      limits:
        memory: "128Mi"
        cpu: "100m"
    autoscaling:
      enabled: false

  production:
    enabled: true
    name: production-app
    port: 8084
    replicas: 1
    resources:
      requests:
        memory: "32Mi"
        cpu: "25m"
      limits:
        memory: "128Mi"
        cpu: "100m"
    autoscaling:
      enabled: false

  engineering:
    enabled: true
    name: engineering-app
    port: 8085
    replicas: 1
    resources:
      requests:
        memory: "32Mi"
        cpu: "25m"
      limits:
        memory: "128Mi"
        cpu: "100m"
    autoscaling:
      enabled: false

  finance:
    enabled: true
    name: finance-app
    port: 8086
    replicas: 1
    resources:
      requests:
        memory: "32Mi"
        cpu: "25m"
      limits:
        memory: "128Mi"
        cpu: "100m"
    autoscaling:
      enabled: false

  docs:
    enabled: true
    name: docs-app
    port: 8087
    replicas: 1
    resources:
      requests:
        memory: "32Mi"
        cpu: "25m"
      limits:
        memory: "128Mi"
        cpu: "100m"
    autoscaling:
      enabled: false

    autoscaling:
      enabled: false

# 服务配置
service:
  type: ClusterIP
  annotations: {}

# Ingress 配置
ingress:
  enabled: true
  className: nginx
  annotations:
    nginx.ingress.kubernetes.io/ssl-redirect: "true"
    nginx.ingress.kubernetes.io/force-ssl-redirect: "true"
    nginx.ingress.kubernetes.io/cors-allow-origin: "*"
    nginx.ingress.kubernetes.io/cors-allow-methods: "GET, POST, PUT, DELETE, PATCH, OPTIONS"
    nginx.ingress.kubernetes.io/cors-allow-headers: "Content-Type, Authorization, X-Requested-With"
    nginx.ingress.kubernetes.io/enable-cors: "true"
  
  # 主机配置
  hosts:
    - host: bellis.com.cn
      app: system
    - host: admin.bellis.com.cn
      app: admin
    - host: logistics.bellis.com.cn
      app: logistics
    - host: quality.bellis.com.cn
      app: quality
    - host: production.bellis.com.cn
      app: production
    - host: engineering.bellis.com.cn
      app: engineering
    - host: finance.bellis.com.cn
      app: finance
    - host: docs.bellis.com.cn
      app: docs
    - host: mobile.bellis.com.cn
      app: mobile
  
  # TLS 配置
  tls:
    enabled: true
    secretName: bellis-tls
    hosts:
      - bellis.com.cn
      - "*.bellis.com.cn"

# ConfigMap 配置
config:
  nodeEnv: production
  apiBaseUrl: "https://api.bellis.com.cn"
  qiankunBaseUrl: "https://bellis.com.cn"

# Nginx 配置
nginx:
  config: |
    server {
        listen 80;
        server_name localhost;
        root /usr/share/nginx/html;
        index index.html;
        
        location / {
            try_files $uri $uri/ /index.html;
        }
        
        location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg)$ {
            expires 1y;
            add_header Cache-Control "public, immutable";
        }
        
        location /health {
            access_log off;
            return 200 "healthy\n";
            add_header Content-Type text/plain;
        }
        
        add_header X-Frame-Options "SAMEORIGIN" always;
        add_header X-XSS-Protection "1; mode=block" always;
        add_header X-Content-Type-Options "nosniff" always;
        add_header Referrer-Policy "no-referrer-when-downgrade" always;
        add_header Content-Security-Policy "default-src 'self' http: https: data: blob: 'unsafe-inline'" always;
    }

# 健康检查配置
healthcheck:
  enabled: true
  path: /health
  initialDelaySeconds: 30
  periodSeconds: 10
  timeoutSeconds: 5
  failureThreshold: 3

# 就绪检查配置
readinessProbe:
  enabled: true
  path: /health
  initialDelaySeconds: 5
  periodSeconds: 5
  timeoutSeconds: 3
  failureThreshold: 3

# 安全上下文
securityContext:
  runAsNonRoot: true
  runAsUser: 101
  fsGroup: 101

# Pod 安全上下文
podSecurityContext:
  runAsNonRoot: true
  runAsUser: 101
  fsGroup: 101

# 节点选择器
nodeSelector: {}

# 容忍度
tolerations: []

# 亲和性
affinity: {}

# Pod 反亲和性（推荐用于生产环境）
podAntiAffinity:
  enabled: false
  type: soft  # soft 或 hard
